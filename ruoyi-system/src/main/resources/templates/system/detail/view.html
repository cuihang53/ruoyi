<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="include :: header('修改销售信息录入')"/>
    <th:block th:include="include :: datetimepicker-css"/>
    <th:block th:include="include :: select2-css"/>
</head>
<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <h4 class="form-header h4">销售基本信息</h4>
    <form class="form-horizontal m" id="form-detail-edit" name="form-detail-edit" th:object="${sysSalesDetail}">
        <input name="salesDetailId" id="salesDetailId" th:field="*{salesDetailId}" type="hidden">
        <div class="row">
            <div class="col-sm-6">
                <label class="col-sm-3 control-label is-required">所属楼盘：</label>
                <div class="col-sm-8">
                    <div class="input-group date">
                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                        <input th:field="*{bulding.buildingName}"
                               readonly
                               class="form-control" type="text">
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <label class="col-sm-3 control-label is-required">所属单元：</label>
                <div class="col-sm-8">
                    <input th:field="*{houseUnit.houseUnitName}"
                           readonly
                           class="form-control" type="text">
                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-sm-6">
                <label class="col-sm-3 control-label is-required">关联房号：</label>
                <div class="col-sm-8">
                    <input th:field="*{house.houseNumber}"
                           readonly
                           class="form-control" type="text">
                </div>
            </div>
            <div class="col-sm-6">
                <label class="col-sm-3 control-label is-required">建筑面积：</label>
                <div class="col-sm-8">
                    <input th:field="*{house.area}"
                           readonly
                           class="form-control" type="text">
                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-sm-6">
                <label class="col-sm-3 control-label is-required">套内面积：</label>
                <div class="col-sm-8">
                    <input th:field="*{house.innerArea}"
                           readonly
                           class="form-control" type="text">
                </div>
            </div>
            <div class="col-sm-6">
                <label class="col-sm-3 control-label is-required">实测面积：</label>
                <div class="col-sm-8">
                    <input th:field="*{house.realArea}"
                           readonly
                           class="form-control" type="text">
                </div>
            </div>
        </div>

        <br>
        <div class="row">
            <div class="col-sm-6">
                <label class="col-sm-3 control-label is-required">类型：</label>
                <div class="col-sm-8">
                    <input th:field="*{house.buildingType}"
                           readonly
                           class="form-control" type="text">
                </div>
            </div>

            <div class="col-sm-6">
                <label class="col-sm-3 control-label">销售底价(元)：</label>
                <div class="col-sm-8">
                    <input name="salseFloorPrice" th:field="*{salseFloorPrice}"
                           readonly
                           class="form-control" type="text">
                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-sm-6">
                <label class="col-sm-3 control-label is-required">销售人员：</label>
                <div class="col-sm-8">
                    <input name="salePerson" id="salePerson" th:field="*{salePerson}"
                           class="form-control" readonly editable="false"
                           type="text">
                </div>
            </div>

            <div class="col-sm-6">
                <label class="col-sm-3 control-label ">销售单状态：</label>
                <div class="col-sm-8">
                    <input name="orderStatus" id="orderStatus" th:field="*{orderStatus}"
                           class="form-control" readonly type="text">
                </div>
            </div>


        </div>
        <br>
        <div class="row">
            <div class="col-sm-6">
                <label class="col-sm-3 control-label is-required">认购人：</label>
                <div class="col-sm-8">
                    <input name="bookBuyer" readonly th:field="*{bookBuyer}" class="form-control" type="text" required>
                </div>
            </div>

            <div class="col-sm-6">
                <label class="col-sm-3 control-label is-required">认购时间：</label>
                <div class="col-sm-8">
                    <div class="input-group date">
                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                        <input name="buyertime" readonly
                               th:value="${#dates.format(sysSalesDetail.buyertime, 'yyyy-MM-dd')}"
                               class="form-control" placeholder="yyyy-MM-dd" type="text" required>
                    </div>
                </div>
            </div>
        </div>
        <br>

        <div class="row">
            <div class="col-sm-6">
                <label class="col-sm-3 control-label is-required">认购单价(元)：</label>
                <div class="col-sm-8">
                    <input name="bookBuyerPrice" th:field="*{bookBuyerPrice}" onchange="setAllprice(1)"
                           readonly
                           class="form-control" type="text" required>
                </div>
            </div>
            <div class="col-sm-6">
                <label class="col-sm-3 control-label is-required">认购总价(元)：</label>
                <div class="col-sm-8">
                    <input name="bookBuyerAllprice" th:field="*{bookBuyerAllprice}" onchange="setAllprice(2)"
                           class="form-control" type="text"
                           readonly
                           required>
                </div>
            </div>
        </div>
        <br>

        <div class="row">
            <div class="col-sm-6">
                <label class="col-sm-3 control-label is-required">认购人联系方式：</label>
                <div class="col-sm-8">
                    <input name="bookBuyerPhone" id="bookBuyerPhone" th:field="*{bookBuyerPhone}"
                           class="form-control m-b" type="text" readonly
                           required>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <label class="col-sm-3 control-label ">签约人：</label>
                <div class="col-sm-8">
                    <input name="finalBuyer" th:field="*{finalBuyer}" class="form-control" readonly type="text">
                </div>
            </div>
            <div class="col-sm-6">
                <label class="col-sm-3 control-label">签合同时间：</label>
                <div class="col-sm-8">
                    <div class="input-group date">
                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                        <input name="contracttime" readonly
                               th:value="${#dates.format(sysSalesDetail.contracttime, 'yyyy-MM-dd')}"
                               class="form-control" placeholder="yyyy-MM-dd" type="text">
                    </div>
                </div>
            </div>

        </div>
        <br>
        <div class="row">
            <div class="col-sm-6">
                <label class="col-sm-3 control-label ">签约人联系方式：</label>
                <div class="col-sm-8">
                    <input readonly name="finalBuyerPhone" th:field="*{finalBuyerPhone}" id="finalBuyerPhone"
                           class="form-control m-b" type="text">
                </div>
            </div>
            <div class="col-sm-6">
                <label class="col-sm-3 control-label ">付款方式：</label>
                <div class="col-sm-8">
                    <select disabled name="payMethod" class="form-control m-b"
                            th:with="type=${@dict.getType('sys_pay_methods')}" required>
                        <option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictLabel}"
                                th:field="*{payMethod}"></option>
                    </select>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                <label class="col-sm-3 control-label ">合同单价(元)：</label>
                <div class="col-sm-8">
                    <input readonly name="contractPrice" th:field="*{contractPrice}" class="form-control"
                           onchange="setAllprice(3)"
                           type="text">
                </div>
            </div>
            <div class="col-sm-6">
                <label class="col-sm-3 control-label ">合同总价(元)：</label>
                <div class="col-sm-8">
                    <input readonly name="contractAllprice" onchange="setAllprice(4)" th:field="*{contractAllprice}"
                           class="form-control" type="text"
                    >
                </div>
            </div>
        </div>
        <br>

        <div class="row">

            <div class="col-sm-6">
                <label class="col-sm-3 control-label ">首付金额(元)：</label>
                <div class="col-sm-8">
                    <input readonly name="installmentPrice" id="installmentPrice" th:field="*{installmentPrice}"
                           onchange="setMortgagePrice()"
                           class="form-control" type="text"
                    >
                </div>
            </div>

            <div class="col-sm-6">
                <label class="col-sm-3 control-label ">按揭金额(元)：</label>
                <div class="col-sm-8">
                    <input readonly name="mortgagePrice" id="mortgagePrice" th:field="*{mortgagePrice}"
                           class="form-control" type="text">
                </div>
            </div>
        </div>
        <br>
        <div class="row">

            <div class="col-sm-6">
                <label class="col-sm-3 control-label ">返租金额(元)：</label>
                <div class="col-sm-8">
                    <input readonly name="rantPrice" id="rantPrice" th:field="*{rantPrice}" onchange="setCollection()"
                           class="form-control"
                           type="text">
                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-sm-6">
                <label class="col-sm-3 control-label ">已收首付金额(元)：</label>
                <div class="col-sm-8">
                    <input name="rdInstallmentPrice" id="rdInstallmentPrice" th:field="*{rdInstallmentPrice}"
                           class="form-control"
                           type="text" readonly>
                </div>
            </div>
            <div class="col-sm-6">
                <label class="col-sm-3 control-label ">剩余首付金额(元)：</label>
                <div class="col-sm-8">
                    <input name="rmiInstallmentPrice" id="rmiInstallmentPrice" th:field="*{rmiInstallmentPrice}"
                           readonly
                           class="form-control" type="text"
                    >
                </div>
            </div>
        </div>

        <br>
        <div class="row">
            <div class="col-sm-6">
                <label class="col-sm-3 control-label ">已收款金额(元)：</label>
                <div class="col-sm-8">
                    <input name="collection" id="collection" th:field="*{collection}"
                           class="form-control" type="text" readonly>
                </div>
            </div>
            <div class="col-sm-6">
                <label class="col-sm-3 control-label ">剩余金额(元)：</label>
                <div class="col-sm-8">
                    <input name="surplusPrice" id="surplusPrice" th:field="*{surplusPrice}"
                           class="form-control"
                           type="text" readonly>
                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-sm-6">
                <label class="col-sm-3 control-label ">优惠说明：</label>
                <div class="col-sm-8">
                    <textarea readonly name="remark" id="remark" th:field="*{remark}" class="form-control" type="text"
                    ></textarea>
                </div>
            </div>
            <div class="col-sm-6">
                <label class="col-sm-3 control-label">附件：</label>
                <div class="col-sm-8">
                    <div id="showFile" name="showFile">
                        <div th:each="fi,fileUtil:${fileUtils}">
                            <span th:text="${fi.attachment.fileName}"></span>
                            <img width="30px" height="30px" onclick="lookImg(this)" th:src="${fi.attachment.filePath}">
                            <a th:value="${fi.attachment.filePath}" href="javascript:;"
                               th:onclick="|downloadFile(${fi.fileUtilId})|">下载</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <input type="hidden" value="" name="cids" id="cids">
        <input type="hidden" value="" name="delids" id="delids">
        <input type="hidden" value="" name="payids" id="payids">
        <input type="hidden" value="" name="fileUtilIds" id="fileUtilIds">
        <input type="hidden" value="" name="recordids" id="recordids">
    </form>
    <script type="text/javascript">
        function lookImg(obj) {
            var img = "<img src='" + $(obj).attr("src") + "' />";
            //捕获页
            layer.open({
                type: 1,
                shade: false,
                title: false, //不显示标题
                area: ['1000px', '700px'],
                // area: [img.width + 'px', img.height+'px'],
                content: img, //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响
                cancel: function () {
                    //layer.msg('捕获就是从页面已经存在的元素上，包裹layer的结构', { time: 5000, icon: 6 });
                }
            })
        }

        function downloadFile(value) {
            if (value == null || value == '') {
                $.modal.alertWarning("请先选择需要下载的文件");
                return false;
            }
            window.location.href = "/system/util/dowLoad?id=" + value;
        }
    </script>

    <form id="form-payment-add" name="form-payment-add">
        <h4 class="form-header h4">收款明细信息</h4>
    </form>

    <table id="payment-table" name="payment-table" class="table table-hover">
        <thead>
        <tr>
            <th style="" data-field="" tabindex="0">
                <div class="th-inner">收款类型</div>
                <div class="fht-cell"></div>
            </th>
            <th style="" data-field="" tabindex="0">
                <div class="th-inner ">收款金额</div>
                <div class="fht-cell"></div>
            </th>
            <th style="" data-field="" tabindex="0">
                <div class="th-inner ">收款时间</div>
                <div class="fht-cell"></div>
            </th>
            <th style="" data-field="" tabindex="0">
                <div class="th-inner ">说明</div>
                <div class="fht-cell"></div>
            </th>
        </tr>
        <tr th:each="pay,paym:${paymentDetails}">
            <td>
                <input th:value="${pay.paymentType}" style="border: none" readonly>
            </td>
            <td>
                <input th:value="${pay.amount}" style="border: none" readonly>
            </td>
            <td>
                <input th:value="${pay.paymentTime}" style="border: none" readonly>
            </td>
            <td>
                <input th:value="${pay.remark}" style="border: none" readonly>
            </td>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <h4 class="form-header h4">提成明细信息</h4>
    <table id="bootstrap-table" name="bootstrap-table" class="table table-hover">
        <thead>
        <tr>
            <th style="" data-field="" tabindex="0">
                <div class="th-inner">岗位</div>
                <div class="fht-cell"></div>
            </th>
            <th style="" data-field="" tabindex="0">
                <div class="th-inner ">提点</div>
                <div class="fht-cell"></div>
            </th>
            <th style="" data-field="" tabindex="0">
                <div class="th-inner ">对应人员</div>
                <div class="fht-cell"></div>
            </th>
            <th style="" data-field="" tabindex="0">
                <div class="th-inner ">完成任务发放比例</div>
                <div class="fht-cell"></div>
            </th>
            <th style="" data-field="" tabindex="0">
                <div class="th-inner ">回款发放比例</div>
                <div class="fht-cell"></div>
            </th>
            <th style="" data-field="" tabindex="0">
                <div class="th-inner ">回款提成发放时间</div>
                <div class="fht-cell"></div>
            </th>
            <th style="" data-field="" tabindex="0">
                <div class="th-inner ">交房发放比例</div>
                <div class="fht-cell"></div>
            </th>
            <th style="" data-field="" tabindex="0">
                <div class="th-inner ">交房提成发放时间</div>
                <div class="fht-cell"></div>
            </th>
            <th style="" data-field="" tabindex="0">
                <div class="th-inner ">备注</div>
                <div class="fht-cell"></div>
            </th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="com,comm:${commissions}">
            <td>
                <input th:value="${com.post.postName}" style="border: none" readonly>
            </td>
            <td>
                <input th:value="${com.remind}" style="border: none" readonly>
            </td>
            <td>
                <input th:value="${com.user.userName}" style="border: none" readonly>
            </td>

            <td>
                <input th:value="${com.completeProp}" style="border: none" readonly>
            </td>
            <td>
                <input th:value="${com.dibProportion}" style="border: none" readonly>
            </td>
            <td>
                <input th:value="${com.dibTime}" style="border: none" readonly>
            </td>
            <td>
                <input th:value="${com.roomProportion}" style="border: none" readonly>
            </td>
            <td>
                <input th:value="${com.roomPrpTime}" style="border: none" readonly>
            </td>
        </tr>
        </tbody>
    </table>
    <form id="form-soParticulars-add" name="form-commission-add">
        <h4 class="form-header h4">订单进度明细信息</h4>
        <table id="soParticulars-table" class="table table-hover">
            <thead>
            <tr>
                <th style="" data-field="" tabindex="0">
                    <div class="th-inner">进度状态</div>
                    <div class="fht-cell"></div>
                </th>
                <th style="" data-field="" tabindex="0">
                    <div class="th-inner ">说明</div>
                    <div class="fht-cell"></div>
                </th>
                <th style="" data-field="" tabindex="0">
                    <div class="th-inner ">完成时间</div>
                    <div class="fht-cell"></div>
                </th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="par,particular:${particulars}">
                <td>
                    <input th:value="${par.orderstatus}" style="border: none" readonly>
                </td>
                <td>
                    <input th:value="${par.remark}" style="border: none" readonly>
                </td>
                <td>
                    <input th:value="${par.completionTime}"
                           placeholder="yyyy-MM-dd" style="border: none" readonly>
                </td>
            </tr>
            </tbody>
        </table>
    </form>

    <form id="form-record-add" name="form-payment-add">
        <h4 class="form-header h4">资料领取记录</h4>
    </form>
    <table id="record-table" name="record-table" class="table table-hover">
        <thead>
        <tr>
            <th style="" data-field="" tabindex="0">
                <div class="th-inner">文件名称</div>
                <div class="fht-cell"></div>
            </th>
            <th style="" data-field="" tabindex="0">
                <div class="th-inner ">领取人</div>
                <div class="fht-cell"></div>
            </th>
            <th style="" data-field="" tabindex="0">
                <div class="th-inner ">领取时间</div>
                <div class="fht-cell"></div>
            </th>
            <th style="" data-field="" tabindex="0">
                <div class="th-inner ">说明</div>
                <div class="fht-cell"></div>
            </th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="reco,record:${recordList}">
            <td>
                <input th:value="${reco.recordFileName}" style="border: none" readonly>
            </td>
            <td>
                <input th:value="${reco.recordPerson}" style="border: none" readonly>
            </td>
            <td>
                <input th:value="${reco.recordTime}"
                       placeholder="yyyy-MM-dd" style="border: none" readonly>
            </td>
            <td>
                <textarea th:value="${reco.remark}"
                          style="border: none" readonly></textarea>
            </td>
        </tr>
        </tbody>
    </table>
    <h4 class="form-header h4">流程处理</h4>
    <div class="row" name="dealMethod" id="dealMethod">
        <div class="col-sm-6">
            <div class="form-group">
                <label class="col-sm-4 control-label ">
                    <input type="radio" name="opinion">同意
                    <input type="radio" name="opinion">驳回
                </label>
                <div class="col-sm-8">
                </div>
            </div>
            <br>
            <div class="form-group">
                <label class="col-sm-4 control-label "> 处理意见
                </label>
                <div class="col-sm-8">
                </div>
            </div>
            <br>
            <div class="form-group">
                <label class="col-sm-4 control-label ">
                     <textarea name="remark" style="width: 500px;">
                    </textarea>
                </label>
                <div class="col-sm-8">

                </div>
            </div>
            <br><br>
            <div class="form-group">
                <label class="col-sm-4 control-label ">
                    <input type="radio" name="dealMethod" checked="checked">继续处理
                    <input type="radio" name="dealMethod" onclick="endOrder()">结束
                </label>
                <div class="col-sm-8">
                </div>
            </div>
        </div>
    </div>
    <div class="row" id="nextUserDiv" name="nextUserDiv">
        <div class="col-sm-6">
            <div class="form-group">
                <label class="col-sm-4 control-label ">下一步处理人：</label>
                <div class="col-sm-8">
                    <div class="input-group">
                        <input onclick="selectPerson(this)" type="text" placeholder="请选择下一步处理人" class="form-control">
                        <span class="input-group-addon"><i class="fa fa-search"></i></span>
                        <input type="hidden" id="nextUser" name="nextUser">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div>
        <table class="table table-hover">
            <thead>
            <tr>
                <th style="" data-field="" tabindex="0">
                    <div class="th-inner">当前处理人</div>
                </th>
                <th style="" data-field="" tabindex="0">
                    <div class="th-inner ">处理时间</div>
                </th>
                <th style="" data-field="" tabindex="0">
                    <div class="th-inner ">处理意见</div>
                </th>
                <th style="" data-field="" tabindex="0">
                    <div class="th-inner ">意见补充</div>
                </th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="mov,moving:${movingList}">
                <td>
                    <input th:value="${mov.applyuser}"
                           type="checkbox" style="border-color:white;width: 200px;">
                </td>
                <td>
                    <input th:value="${reco.dealtime}"
                           placeholder="yyyy-MM-dd" class="form-control" style="border-color:white;width: 200px;"
                           readonly>
                </td>
                <td>
                    <input th:value="${reco.opinion}" class="form-control" style="border-color:white;width: 200px;"
                           readonly>
                </td>
                <td>
                <textarea th:value="${reco.remark}"
                          class="form-control" style="border-color:white;width: 300px;" readonly></textarea>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <br>
    <div class="row">
        <div class="col-sm-offset-5 col-sm-10">
            <button type="button" id="submitButton" class="btn btn-sm btn-primary" onclick="submitHandler()"><i
                    class="fa fa-check"></i>提交
            </button>&nbsp;
            <button type="button" class="btn btn-sm btn-danger" onclick="closeItem()"><i class="fa fa-reply-all"></i>关 闭
            </button>
        </div>
    </div>
</div>

<th:block th:include="include :: footer"/>
<th:block th:include="include :: datetimepicker-js"/>
<th:block th:include="include :: select2-js"/>
<script type="text/javascript">
    var prefix = ctx + "system/detail";
    $("#form-detail-edit").validate({
        focusCleanup: true
    });

    function submitHandler() {
        if ($.validate.form()) {
            var data = $("#form-detail-edit").serializeArray();
            var status = $("input[id='status']").is(':checked') == true ? 0 : 1;
            data.push({"name": "status", "value": status});
            $.operate.saveTab(prefix + "/editSave", data);
        }
    }

</script>
</body>
</html>